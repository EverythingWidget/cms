window.addEventListener("load",function(){function initPlugins(element){(element.innerHTML||"input"===element.nodeName.toLowerCase()||"textarea"===element.nodeName.toLowerCase())&&EW.initPlugins($(element))}System.entity("stage/init-ui-components").call();var appBarComponent=System.entity("ui/app-bar"),appsComponent=System.entity("ui/apps");$.fn.textWidth=function(){var html_org=$(this).html(),html_calc='<span style="white-space:nowrap">'+html_org+"</span>";$(this).html(html_calc);var width=$(this).find("span:first").width();return $(this).html(html_org),width},$.fn.comeIn=function(dur){if(!this.is(":visible")||"visible"!==this.css("visibility")){var orgClass="";this.stop(!0,!0),this.prop("class")&&(orgClass=this.prop("class").replace("btn-hide","")),this.addClass("btn-hide").css({display:""}),this.animate({className:orgClass},dur||300,"Power2.easeInOut")}return this},$.fn.comeOut=function(dur){return this.hasClass("btn-hide")||this.stop(!0,!0).animate({className:this.prop("class")+" btn-hide"},dur||300,"Power2.easeInOut",function(){this.hide()}),this},$.fn.loadingText=function(t){return this},ew_plugins.linkChooser=function(options){function LinkChooser(element,options){var $element=$(element);defaults.callback=function(link){$element.val(JSON.stringify(link||"{}")).change(),linkChooserDialog.trigger("close")};var settings=$.extend({},defaults,options);linkChooserDialog&&linkChooserDialog.remove(),$element.EW().inputButton({title:'<i class="link-icon"></i>',label:"tr{Link Chooser}",class:"btn-default",onClick:function(){linkChooserDialog=EW.createModal({class:"center slim"}),System.loadModule({url:"html/admin/content-management/link-chooser/component.php",params:{callback:settings.callbackName,data:$element.val(),contentType:$element.data("content-type")||"all"}},function(module){module.scope.onSelect=settings.callback,linkChooserDialog.html(module.html)})}})}var linkChooserDialog,defaults={callbackName:"function-reference"};return this.each(function(){$.data(this,"ew_plugin_link_chooser")||($.data(this,"ew_plugin_link_chooser",!0),new LinkChooser(this,options))})},ew_plugins.imageChooser=function(options){function ImageChooser(element,options){var $element=$(element);$element.off("change.image-chooser"),$element.on("change.image-chooser",function(){image.attr("src",$element.val()||"html/admin/content-management/media/no-image.png")}),defaults.callback=function(link){imageChooserDialog.dispose()};var settings=$.extend({},defaults,options);$element.parent().attr("data-element-wrapper")||$element.wrap('<div class="element-wrapper" style="position:relative;padding-bottom:30px;" data-element-wrapper="true"><div style="padding:5px 0;border:2px dashed #aaa;background-color:#fff;display:block;overflow:hidden;" data-element-wrapper="true"></div></div>'),$element.attr("type","hidden");var wrapper=$element.parent().parent();imageChooserDialog&&imageChooserDialog.remove();var image=wrapper.find("img");image.length<=0&&(image=$(document.createElement("img")),wrapper.find("div").append(image)),image.css("max-height",$element.css("max-height"));var imageChooserBtn;$element.attr(ACTIVE_PLUGIN_ATTR)?imageChooserBtn=wrapper.find(".btn-image-chooser"):(image.attr("src",$element.val()||"asset/images/no-image.png"),image.css({border:"none",outline:"none",minHeght:"128px",maxWidth:"720px",display:"block",float:"",margin:"2px auto 2px auto"}),imageChooserBtn=$("<button type='button' class='btn btn-xs btn-link btn-image-chooser'>Choose Image</button>"),imageChooserBtn.css({position:"absolute",right:"2px",bottom:"2px"}),wrapper.append(imageChooserBtn),$element.attr(ACTIVE_PLUGIN_ATTR,!0)),imageChooserBtn.click(function(){imageChooserDialog=EW.createModal({autoOpen:!1,class:"center"}),System.loadModule({url:"html/admin/content-management/link-chooser/link-chooser-media.php",params:{callback:settings.callbackName},fresh:!0},function(module){imageChooserDialog.html(module.html),module.scope.selectMedia=function(image){$element.val(image.src).change(),imageChooserDialog.dispose()}}),imageChooserDialog.open()})}var imageChooserDialog,ACTIVE_PLUGIN_ATTR="data-active-plugin-image-chooser",defaults={callbackName:"function-reference"};return this.each(function(){$.data(this,ACTIVE_PLUGIN_ATTR)||$.data(this,ACTIVE_PLUGIN_ATTR,new ImageChooser(this,options))})};var mouseInNavMenu=!1,enterOnLink=!1,currentSectionIndex=null;System.ui.body=$("body")[0],System.ui.components={appMainActions:$("#app-main-actions"),mainContent:$("#main-content"),body:$("body"),document:$(document),navigationMenu:$("#navigation-menu"),appsMenu:$("#apps-menu"),sectionsMenu:$("#sections-menu"),sectionsMenuList:$("#sections-menu-list")},System.ui.behaviors.highlightAppSection=function(index,section){currentSectionIndex=index,EW.selectedSection&&System.ui.utility.removeClass(EW.selectedSection,"selected"),EW.selectedSection=section,System.ui.utility.addClass(EW.selectedSection,"selected")},System.ui.components.sectionsMenuList[0].onSetData=function(data){data.length?mouseInNavMenu&&TweenLite.to(System.ui.components.sectionsMenu[0],.3,{className:"sections-menu in",ease:"Power2.easeInOut"}):(System.ui.components.sectionsMenu.css("height",System.ui.components.sectionsMenu.height()),TweenLite.to(System.ui.components.sectionsMenu[0],.2,{className:"sections-menu out",height:"94px",ease:"Power2.easeInOut",onComplete:function(){System.ui.components.sectionsMenu.css("height","")}}))},System.ui.components.sectionsMenuList[0].addEventListener("item-selected",function(event){event.detail.data.id!==appBarComponent.currentApp+"/"+appBarComponent.currentSection&&System.setHashParameters({app:event.detail.data.id})}),System.ui.components.navigationMenu.on("mouseenter touchstart",function(){mouseInNavMenu||(mouseInNavMenu=!0,System.ui.components.navigationMenu.addClass("expand"),System.ui.components.sectionsMenuList[0].data.length&&(enterOnLink||(System.ui.components.sectionsMenu[0].style.top=System.ui.components.appsMenu.find(".apps-menu-link.selected")[0].offsetTop+"px"),System.ui.behaviors.highlightAppSection(currentSectionIndex,System.ui.components.sectionsMenuList[0].links[currentSectionIndex]),TweenLite.to(System.ui.components.sectionsMenu[0],.3,{className:"sections-menu in",ease:"Power2.easeInOut"})))});var moveAnim=null;System.ui.components.appsMenu.on("mouseenter touchstart","a",function(event){var app=event.currentTarget.dataset.app;EW.hoverApp="system/"+app;var sections=System.modules["system/"+app]?System.modules["system/"+app].data.sections:[];return System.ui.components.sectionsMenuList[0].data!==sections&&(System.ui.components.sectionsMenuList[0].data=sections),EW.oldApp===app&&System.ui.behaviors.highlightAppSection(currentSectionIndex,System.ui.components.sectionsMenuList[0].links[currentSectionIndex]),mouseInNavMenu?void(moveAnim=TweenLite.to(System.ui.components.sectionsMenu[0],.2,{top:event.currentTarget.offsetTop})):(System.ui.components.sectionsMenu[0].style.top=event.currentTarget.offsetTop+"px",void(enterOnLink=!0))}),System.ui.components.navigationMenu.on("click",function(event){event.target===System.ui.components.navigationMenu[0]&&(System.ui.components.navigationMenu.removeClass("expand"),TweenLite.to(System.ui.components.sectionsMenu[0],.2,{className:"sections-menu",ease:"Power2.easeInOut",onComplete:function(){System.services.app_service.loading_app||currentSectionIndex===System.ui.components.sectionsMenuList[0].value||(System.ui.components.sectionsMenuList[0].data=EW.currentAppSections,System.ui.behaviors.highlightAppSection(currentSectionIndex,EW.selectedSection))}}))}),System.ui.components.navigationMenu.on("mouseleave",function(){mouseInNavMenu=!1,enterOnLink=!1,System.ui.components.navigationMenu.removeClass("expand"),TweenLite.to(System.ui.components.sectionsMenu[0],.2,{className:"sections-menu",ease:"Power2.easeInOut",onComplete:function(){System.services.app_service.loading_app||currentSectionIndex===System.ui.components.sectionsMenuList[0].value||(System.ui.components.sectionsMenuList[0].data=EW.currentAppSections,System.ui.behaviors.highlightAppSection(currentSectionIndex,EW.selectedSection))}})}),new hashHandler,EW.activities=EW_ACTIVITIES,EW.oldApp=null,EW.apps={},initPlugins(document),EW_APPS.forEach(function(item){EW.apps[item.id]=item}),System.init(EW_APPS),System.app.on("app",System.services.app_service.load),System.app.onGlobal("ew_activity",System.services.app_service.load_activity),System.start(),appsComponent.apps=EW_APPS,appBarComponent.selectedTab=System.getHashParam("app"),System.getHashParam("app")||System.setHashParameters({app:"content-management"},!0);var $document=$(document);$document.ajaxError(function(event,data,status){if(!data||"abort"!==data.statusText){if(EW.customAjaxErrorHandler)return void(EW.customAjaxErrorHandler=!1);try{var errorsList="<ul>";$.each(data.responseJSON.reason,function(current,i){errorsList+="<li><h4>"+current+"</h4><p>"+i.join()+"</p></li>"}),errorsList+="</ul>"}catch(e){console.log("ajaxError: ",e),console.log(data),console.log(e.stack)}System.ui.components.body.EW().notify({message:{html:data.responseJSON?data.responseJSON.message+errorsList:"---ERROR---"},status:"error",position:"n",delay:"stay"}).show()}}),$("select").selectpicker({container:"body"});var observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){"childList"===mutation.type&&mutation.addedNodes.length&&mutation.addedNodes[0].nodeType===Node.ELEMENT_NODE&&initPlugins(mutation.target)})});observer.observe(document.body,{attributes:!1,childList:!0,characterData:!1,subtree:!0})}),function(){function init(){var navMenuVue=new Vue({el:"#navigation-menu",data:{apps:[],currentState:null,currentApp:null,currentSection:null,currentSubSection:null,isNavTitleIn:!1,isNavMenuIn:!1},methods:{goToState:function(state){if(System.modules["system/"+state]){var lastSelectedSection=System.modules["system/"+state].params.app||state;return System.app.setNav(lastSelectedSection)}System.app.setNav(state)},navMenuIn:function(){this.isNavMenuIn=!0},navMenuOut:function(){this.isNavMenuIn=!1}}});System.entity("ui/apps",navMenuVue);var primaryActionsVue=new Vue({el:"#main-float-menu",data:{actions:[]},methods:{callActivity:function(action){var activityCaller=EW.getActivity(action);activityCaller(action.hash)}}});System.entity("ui/primary-menu",primaryActionsVue);var appBarVue=new Vue({el:"#app-bar",data:{appTitle:"",sectionTitle:"",isLoading:!1,subSections:null,currentSubSection:navMenuVue.currentSubSection},computed:{styleClass:function(){var classes=[];return this.subSections&&this.subSections.length&&classes.push("tabs-bar-on"),classes.join(" ")},currentState:function(){return navMenuVue.currentState}},methods:{goTo:function(tab,$event){$event.preventDefault(),System.app.setNav(navMenuVue.currentApp+"/"+navMenuVue.currentSection+"/"+tab.state)},goToState:function(state){System.app.setNav(state)},navTitleIn:function(){navMenuVue.isNavTitleIn=!0},navTitleOut:function(){navMenuVue.isNavTitleIn=!1}}});System.entity("ui/app-bar",appBarVue);var mainContentVue=new Vue({el:"#main-content",data:{show:!1},computed:{styleClass:function(){var classes=[];return appBarVue.subSections&&appBarVue.subSections.length&&classes.push("tabs-bar-on"),classes.join(" ")}}});System.entity("ui/main-content",mainContentVue);var linkChooserDialog={};linkChooserDialog.open=function(onSelect){var linkChooserDialog=EW.createModal({class:"center slim"});return System.loadModule({url:"html/admin/content-management/link-chooser/component.php",params:{contentType:"content"}},function(module){module.scope.onSelect=function(content){onSelect.call(null,content),linkChooserDialog.dispose()},linkChooserDialog.html(module.html)}),linkChooserDialog},System.entity("ui/dialogs/link-chooser",linkChooserDialog),ContentTools.Tools.EWMedia=function(superClass){function EWMedia(){return EWMedia.__super__.constructor.apply(this,arguments)}return System.utility.extend(EWMedia,superClass),ContentTools.ToolShelf.stow(EWMedia,"ew-media"),EWMedia.label="EW Media",EWMedia.icon="ew-media",EWMedia.tagName="p",EWMedia.canApply=function(element,selection){return!0},EWMedia.apply=function(item,selection,callback){var app,_this=this;app=ContentTools.EditorApp.get();var imageChooserDialog=EW.createModal({autoOpen:!1,class:"center"});return System.loadModule({id:"media-chooser",url:"html/admin/content-management/link-chooser/link-chooser-media.php",params:{callback:""}},function(module,html){imageChooserDialog.html(html);var ref=_this._insertAt(item),node=ref[0],index=ref[1];module.scope.selectMedia=function(item){if(item===!1)return void imageChooserDialog.dispose();switch(item.type){case"text":var text=new ContentEdit.Text("p",{},item.text);if(node.parent())node.parent().attach(text,index);else{var firstRegion=app.orderedRegions()[0];firstRegion.attach(text,index)}text.focus();break;case"image":var image=new ContentEdit.Image({src:item.src,width:item.width,height:item.height});if(node.parent())node.parent().attach(image,index);else{var firstRegion=app.orderedRegions()[0];firstRegion.attach(image,index)}image.focus()}imageChooserDialog.dispose()}}),imageChooserDialog.open(),callback(!0)},EWMedia}(ContentTools.Tool)}System.entity("stage/init-ui-components",init)}(),function(){System.services.app_service={loading_app:!1},System.services.app_service.on_load=function(app){app&&(this.loading_app=!0,System.entity("ui/app-bar").isLoading=!0,EW.selectedSection&&System.ui.utility.addClass(EW.selectedSection,"inline-loader"),System.entity("ui/main-content").show=!1)},System.services.app_service.on_loaded=function(app,html){$("#app-content").append(html),"app"===app.type&&(EW.currentAppSections=System.modules[app.id].data.sections,EW.hoverApp=app.id,System.ui.components.sectionsMenuList[0].data=EW.currentAppSections,app.start()),this.loading_app=!1},System.services.app_service.load=function(path,app){if(app&&"Home"!==app||(app="content-management"),System.entity("ui/apps").currentState=path.join("/"),System.entity("ui/apps").currentApp=path[0],System.entity("ui/apps").currentSection=path[1],System.entity("ui/apps").currentSubSection=path[2],app!==EW.oldApp)return EW.oldApp=app,System.entity("ui/app-bar").appTitle=EW.apps[app].title,System.services.app_service.on_load(EW.apps[app]),void System.loadModule(EW.apps[app],function(module){System.services.app_service.on_loaded(module,module.html)})},System.services.app_service.load_section=function(moduleId){var element=System.ui.components.sectionsMenuList[0].links[EW.oldApp+"/"+moduleId];if(System.ui.behaviors.highlightAppSection(element.dataset.index,element),element){var moduleConfig=System.ui.components.sectionsMenuList[0].data[element.dataset.index];if(!moduleConfig)return;EW.oldSectionId=moduleConfig.id,System.entity("ui/app-bar").sectionTitle=moduleConfig.title,System.entity("ui/app-bar").isLoading=!0,System.ui.utility.addClass(element,"inline-loader"),System.entity("ui/app-bar").subSections=[],System.entity("ui/primary-menu").actions=[],$("#app-main-actions").empty(),System.ui.components.mainContent.empty(),System.abortAllRequests(),System.loadModule(moduleConfig,function(module,html){$("#action-bar-items").find("button,div").remove(),System.getHashNav("app")[0]&&(System.entity("ui/app-bar").subSections=module.data.subSections||[],System.entity("ui/main-content").show=!1,System.ui.components.mainContent.html(html),module.start(),System.entity("ui/app-bar").isLoading=!1,System.ui.utility.removeClass(element,"inline-loader"),Vue.nextTick(function(){System.entity("ui/main-content").show=!0}))})}},System.services.app_service.load_tab=function(module){function tab_loaded(module,html){System.getHashNav("app")[0]&&(System.entity("ui/main-content").show=!1,System.ui.components.mainContent.html(html),"function"==typeof module.start&&module.start(),System.entity("ui/app-bar").isLoading=!1,Vue.nextTick(function(){System.entity("ui/main-content").show=!0}))}System.entity("ui/app-bar").isLoading=!0,System.entity("ui/primary-menu").actions=[],$("#app-main-actions").empty(),System.ui.components.mainContent.empty(),System.abortAllRequests(),System.loadModule(module,tab_loaded)},System.services.app_service.select_app_section=function(component,full,section){return section?void(component.data.tab!==section&&(component.data.tab=section,System.services.app_service.load_section(section))):void(System.ui.components.sectionsMenuList[0].value="0")},System.services.app_service.select_sub_section=function(component,full,tab){if(tab){component.data.activeSubSection=tab,System.entity("ui/app-bar").currentSubSection=tab;var subSectionConfig=System.entity("ui/app-bar").subSections.filter(function(item){return item.state===tab})[0];System.services.app_service.load_tab(subSectionConfig)}else if(component.data.activeSubSection){var appBar=System.entity("ui/apps");appBar.goToState(appBar.currentApp+"/"+appBar.currentSection+"/"+component.data.activeSubSection)}};var oldEWActivity=null;System.services.app_service.load_activity=function(activityId){var url=activityId?activityId.substr(0,activityId.lastIndexOf("_")):null,activityName=activityId;url&&url!==activityId&&(activityName=url);var currentActivity=EW.activities[activityId]||EW.activities[activityName];if(activityName&&activityName!==oldEWActivity){var settings={closeHash:{},onOpen:function(){var modal=this,activityParameters=EW.getHashParameters();currentActivity.parameters&&("function"==typeof currentActivity.parameters?($.extend(activityParameters,currentActivity.parameters(activityParameters)),System.setHashParameters(activityParameters,!0)):currentActivity.parameters&&($.extend(activityParameters,currentActivity.parameters),System.setHashParameters(activityParameters,!0))),currentActivity.newParams&&($.extend(activityParameters,currentActivity.newParams),System.setHashParameters(activityParameters,!0)),activityParameters=EW.getHashParameters();var method=currentActivity.request.method||"GET";$.ajax({type:method,url:currentActivity.request.url,data:$.extend({},activityParameters,currentActivity.privateParams),success:function(data){modal.html(data)},error:function(result){console.log(result),modal.html(result.responseText),result.responseJSON&&alert(result.responseJSON.message),EW.customAjaxErrorHandler=!0}})},onClose:function(){if(currentActivity=EW.activities[activityId]||EW.activities[activityName]){EW.activitySource=null;var closeHashParameters={ew_activity:null};currentActivity.onDone&&("function"==typeof currentActivity.onDone?currentActivity.onDone(closeHashParameters):$.extend(closeHashParameters,currentActivity.onDone)),$(document).trigger(activityName+".close",closeHashParameters),$.extend(closeHashParameters,settings.closeHash),EW.setHashParameters(closeHashParameters)}}};currentActivity?($(document).trigger(activityName+".open",settings),$.extend(settings,currentActivity.modal),currentActivity.modalObject=EW.activities[activityName].modalObject=EW.createModal(settings)):(alert("Activity not found: "+activityName),EW.setHashParameters({ew_activity:null})),oldEWActivity=activityName}else oldEWActivity!==activityName&&(oldEWActivity&&EW.activities[oldEWActivity].modalObject&&EW.activities[oldEWActivity].modalObject.trigger("close"),oldEWActivity=activityName)}}();